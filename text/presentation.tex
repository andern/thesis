\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage{tikz}
\usepackage{tikz-cd}
\usetikzlibrary{intersections,positioning,calc,arrows,shapes,
                decorations.pathreplacing,spy,automata}
\usepackage{pgfplots}
\usepackage[ruled]{algorithm2e}
\usetheme{boxes}
\title[Fast Solver of Closely Related Quadratic Programming Problems]
      {Fast Solver of Closely Related Quadratic Programming Problems}
\author{Andreas Halle}
%\institute{Department of Informatics}
\date{June 10, 2013}


\definecolor{tleblue}{RGB}{178,175,255}
\DeclareMathOperator*{\argmin}{arg\,min}


\begin{document}



\begin{frame}
\titlepage
\end{frame}



\section{Introduksjon}



\begin{frame}{PROMAPS}
\begin{itemize}
\item Utviklet av Goodtech og MathConsult
\item Kalkulerer leveransepåliteligheten i et nettverk
\item Utfall: Gren i nettverket faller ut
\item Formulert som mange like QP-problemer
\item Flaskehals: QP-løseren
\item Skjermbildet oppdateres hvert 5. minutt
\item \url{http://www.tu.no/energi/2011/10/07/her-beregnes-risikoen-for-svikt-i-kraftnettet}
\end{itemize}
\end{frame}



\begin{frame}{Objektfunksjonen}
\[
f(x) = x^T \Phi D x + (g - c)^T x
\]
\begin{itemize}
\item $x = \left[ \begin{array}{cccc} x_1 & x_2 & \cdots & x_n \end{array} \right]^T$
\item $f(x)$ representerer leveransekostnader ($E/s$)
\item $x$ representerer strømmen over grenene ($W$)
\item $\Phi$ representerer strømtap ($1/W$)
\item $D$ representerer overføringskostnader ($E/J$)
\item $g$ representerer kostnader for å generere strøm ($E/J$)
\item $c$ representerer leveransepris ($E/J$)
\end{itemize}
\end{frame}



\begin{frame}{Objektfunksjonen}
\[
f(x) = x^T H x + b^T x
\]
\begin{itemize}
\item $H = \Phi D$ representerer kostnader ($E/(W^2 s)$)
\item $b = g - c$ representerer kostnader ($E/J$)
\item Minimerer kostnader
\end{itemize}
\end{frame}



\begin{frame}{Optimeringsproblemet}
Et konvekst QP-problem
\[
\min_{x \in \mathbb{R}^n} f(x) \quad \textrm{subject to} ~ Ax = 0, ~ l \leq x \leq u
\]
\begin{itemize}
\item A er en $m \times n$ orientert insidensmatrise for et strømnettverk (rettet graf)
\item $m$ noder, $n$ grener
\item $l$ er nedre grenkapasitet ($W$)
\item $u$ er øvre grenkapasitet ($W$)
\end{itemize}
\end{frame}



\begin{frame}{Utfall}
Modellerer utfall
\begin{itemize}
\item Setter $l_i = u_i = 0 \Rightarrow x_i = 0$
\item Løse QP-problemet for så mange utfall som mulig
\item Instans er et QP-problem uten utfall
\item Subinstans er en instans med utfall
\end{itemize}
\end{frame}



\begin{frame}{Utfall}
\begin{itemize}
\item $2^n$ mulige utfall
\item Usannsynlig at det er mange utfall
\item Løse alle subinstanser med maks et gitt antall utfall
\end{itemize}
%\[
%\sigma (\beta, n) = \sum_{j=0}^{\beta} \binom{n}{j}
%\]
\end{frame}



%\begin{frame}{Subinstanser}
%\begin{itemize}
%\item En mengde av variabler som representerer utfall $\mathcal{M}_k$
%\item $k = \sum_{j \in \mathcal{M}_k}^{} 2^{j-1}$
%\item Eks. $\mathcal{M}_k = \left\{1,3,5 \right\}$. $k = 21$
%\item En subinstans $\mathcal{Q}_k$ defineres av $\mathcal{M}_k$
%\item Optimal løsning til subinstans $\mathcal{Q}_k$ noterer vi som $x_k^*$
%\end{itemize}
%\end{frame}



\begin{frame}{Instanser fra Goodtech}
\input{include/newhistH}
\end{frame}



\begin{frame}{Instanser fra Goodtech}
\begin{table}[ht!]
    \centering
    \caption{Størrelse for hver instans}
    \begin{tabular}{lrrr}
    Problemstørrelse & \textit{small} & \textit{large} & \textit{vlarge} \\\hline
    Rader        & 82             & 328            & 1127 \\
    Kolonne      & 238            & 952            & 3437 \\
    Ikke-nuller A & 348            & 1392           & 4840 \\
    Ikke-nuller H & 108            & 432            & 894 \\
    \end{tabular}
    \label{table:sizes}
\end{table}
\begin{table}[ht!]
    \centering
    \caption{Verdier i objektfunksjonen}

    \begin{tabular}{lrr}
      & \textit{small} og \textit{large}         & \textit{vlarge} \\\hline
    $\max(h_{ii})$      & $2.9614 \times 10^{-2}$ & $4.9011 \times 10^{-2}$ \\
    $\min(h_{ii})$      & $4.9290 \times 10^{-5}$ & $1.1026 \times 10^{-5}$ \\
$\textrm{mean}(h_{ii})$ & $5.2864 \times 10^{-3}$ & $5.8984 \times 10^{-3}$ \\
    $\max(b_{i})$       & 20                      & 20 \\
    $\min(b_{i})$       & -70                     & -50 \\
    \end{tabular}
    \label{table:maxmin}
\end{table}
\end{frame}



\begin{frame}{Instanser fra Goodtech}
\begin{itemize}
\item $hii \ll b_i$
\end{itemize}
$
\begin{array}{llrl}
\mathcal{Q}: \quad & \min_{x \in \mathbb{R}^n} & x^T H x + b^T x & \textrm{subject to} ~ Ax = 0, ~ l \leq x \leq u \\
\mathcal{L}: \quad & \min_{x \in \mathbb{R}^n} & b^T x & \textrm{subject to} ~ Ax = 0, ~ l \leq x \leq u
\end{array}
$
\begin{itemize}
\item Optimal løsning til $\mathcal{Q}$ noteres $x^*$
\item Optimal løsning til $\mathcal{L}$ noteres $\hat{x}$
\item $\Delta$ noterer avviket mellom $f(x^*)$ og $f(\hat{x})$
\end{itemize}
\end{frame}



\begin{frame}{Hvor like er $\mathcal{L}$ og $\mathcal{Q}$?}
\begin{figure}[ht!]
\input{include/delta}
\caption{Avvik som en funksjon av tettheten i $H$.}
\end{figure}
\end{frame}



\begin{frame}{Hvor like er $\mathcal{L}$ og $\mathcal{Q}$?}
Oppnår $95\%$ optimal verdi etter løst $\mathcal{L}$.
\begin{itemize}
\item Metode basert på successive linear programming (SLP)
\item $x_0 = 0 \Rightarrow 95\%$ av optimal målfunksjonsverdi etter $1$ iterasjon
%\item Taylor-utvikling i $x_k$ noterer vi som $T_k$
%\item Definerer $\mathcal{L}_k$ som LP-problemet å minimere $T_k$ underlagt
%      sidekravene til $\mathcal{Q}$.
\end{itemize}
\end{frame}



%\begin{frame}{Slp}
%\input{include/slp_algo}
%\end{frame}



\begin{frame}{Et eksempel}
\[
\begin{array}{lcrcrcl}
\mathcal{Q}: \textrm{minimize}           & &   (x-1)^2 &+&   (y-1)^2 & - &  2 \\
\textrm{subject to}         & &         x &+&         y &\leq& 3 \\
                            & &         x &-&         y &\leq& 1 \\
                            & &         x &+&       3 y &\leq& 4 \\
                 \multicolumn{5}{r}{x,y}                &\geq& 0 \\ \\
\mathcal{L}: \textrm{minimize}  &-&  2 x &-&       2 y &    &  \\
\textrm{subject to}         & &         x &+&         y &\leq& 3 \\
                            & &         x &-&         y &\leq& 1 \\
                            & &         x &+&       3 y &\leq& 4 \\
                 \multicolumn{5}{r}{x,y}                &\geq& 0
\end{array}
\]
\end{frame}



\begin{frame}{$\mathcal{L}_0$}
\begin{center}
\input{include/slpfirst}
\end{center}
\end{frame}



\begin{frame}{Linjesøk}
\begin{center}
\input{include/slpsecond}
\end{center}
\end{frame}




\begin{frame}{$\mathcal{L}_1$}
\begin{center}
\input{include/slpthird}
\end{center}
\end{frame}



\begin{frame}{$\mathcal{L}_2$}
\begin{center}
\input{include/slpfourth}
\end{center}
\end{frame}



\begin{frame}{Sti}
\begin{center}
\input{include/slppath}
\end{center}
\end{frame}



\begin{frame}{Endrer et sidekrav}
\begin{center}
\input{include/slppractical1}
\end{center}
\begin{itemize}
\item $-x + 3y \leq 4$
\item $-x + 3y \leq 0$
\end{itemize}
\end{frame}



\begin{frame}{Like optimale løsninger}
\begin{itemize}
\item Metode for å redusere antall QP-kall
%\item En mengde $\mathcal{M}_k$ med grener som faller ut.
%\item En subinstans $\mathcal{Q}_k$ definert av $\mathcal{Q}$ og $\mathcal{M}_k$
%\item Optimal løsning til $\mathcal{Q}_k$ noteres som $x_k^*$
%\item En mengde med variabler som er $0$ i $x_k^*$ noteres som $\mathcal{Z}_k$.
%\item $2^n - 1$ subinstanser. $\left| \mathcal{Z}_0 \right| = 1749$ i \textit{vlarge}.
%\item $2^{1749} \approx 3 \times 10^{526}$ subinstanser har løsning $x_0^*$
\end{itemize}
\begin{center}
\begin{tikzpicture}
\node (A) at (0, 0) {$(3,$};
\node (B) at (0.4, 0) {$0,$};
\node (C) at (0.8, 0) {$7,$};
\node (D) at (1.2, 0) {$0,$};
\node (E) at (1.6, 0) {$4)$};

\node (a) at (0, 3) {$(3,$};
\node (b) at (0.4, 3) {$0,$};
\node (c) at (0.8, 3) {$7,$};
\node (d) at (1.2, 3) {$0,$};
\node (e) at (1.6, 3) {$4)$};

\node (F) at (3, 0) {$(a,$};
\node (G) at (3.4, 0) {$b,$};
\node (H) at (3.8, 0) {$0,$};
\node (I) at (4.2, 0) {$c,$};
\node (J) at (4.6, 0) {$d)$};

\node (f) at (3, 3) {$(3,$};
\node (g) at (3.4, 3) {$0,$};
\node (h) at (3.8, 3) {$7,$};
\node (i) at (4.2, 3) {$0,$};
\node (j) at (4.6, 3) {$4)$};

\draw[-] (B) -- (b) {};
\draw[-] (D) -- (d) {};


\draw[-] (H) -- (h) {};
\end{tikzpicture}
\end{center}
\end{frame}



\begin{frame}{En trekonstruksjon}
\begin{center}
\input{include/treepresentation}
\[
\small
    \begin{array}{ll}
        \mathcal{M}_0    = \left\{{}\right\}           & \mathcal{Z}_0    = \left\{{1,3}\right\} \\
        \mathcal{M}_2    = \left\{{2}\right\}          & \mathcal{Z}_2    = \left\{{2,3,5}\right\} \\
        \mathcal{M}_3    = \left\{{1,2}\right\}        & \mathcal{Z}_3    = \left\{{1,2,4,5}\right\} \\
        \mathcal{M}_7    = \left\{{1,2,3}\right\}      & \mathcal{Z}_7    = \left\{{1,2,3,5}\right\} \\
        \mathcal{M}_8    = \left\{{4}\right\}          & \mathcal{Z}_8    = \left\{{1,4,5}\right\} \\
        \mathcal{M}_{10} = \left\{{2,4}\right\}        & \mathcal{Z}_{10} = \left\{{2,3,4,5}\right\}
    \end{array}
~
    \begin{array}{ll}
        \mathcal{M}_{12} = \left\{{3,4}\right\}        & \mathcal{Z}_{12} = \left\{{4,3,1}\right\} \\
        \mathcal{M}_{15} = \left\{{1,2,3,4}\right\}    & \mathcal{Z}_{15} = \left\{{1,2,3,4}\right\} \\
        \mathcal{M}_{16} = \left\{{5}\right\}          & \mathcal{Z}_{16} = \left\{{1,3,5}\right\} \\
        \mathcal{M}_{28} = \left\{{3,4,5}\right\}      & \mathcal{Z}_{28} = \left\{{2,3,4,5}\right\} \\
        \mathcal{M}_{29} = \left\{{1,3,4,5}\right\}    & \mathcal{Z}_{29} = \left\{{1,2,3,4,5}\right\}
    \end{array}
\]
\end{center}
\end{frame}



%\begin{frame}{Søker etter $\mathcal{M}_{14} = \left\{  2,3,4 \right\}$}
%\begin{center}
%\input{include/maptreesets3}
%\[
%\small
%    \begin{array}{ll}
%        \mathcal{M}_0    = \left\{{}\right\}           & \mathcal{Z}_0    = \left\{{1,3}\right\} \\
%        \mathcal{M}_2    = \left\{{2}\right\}          & \mathcal{Z}_2    = \left\{{2,3,5}\right\} \\
%        \mathcal{M}_3    = \left\{{1,2}\right\}        & \mathcal{Z}_3    = \left\{{1,2,4,5}\right\} \\
%        \mathcal{M}_7    = \left\{{1,2,3}\right\}      & \mathcal{Z}_7    = \left\{{1,2,3,5}\right\} \\
%        \mathcal{M}_8    = \left\{{4}\right\}          & \mathcal{Z}_8    = \left\{{1,4,5}\right\} \\
%        \mathcal{M}_{10} = \left\{{2,4}\right\}        & \mathcal{Z}_{10} = \left\{{2,3,4,5}\right\}
%    \end{array}
%~
%    \begin{array}{ll}
%        \mathcal{M}_{12} = \left\{{3,4}\right\}        & \mathcal{Z}_{12} = \left\{{4,3,1}\right\} \\
%        \mathcal{M}_{15} = \left\{{1,2,3,4}\right\}    & \mathcal{Z}_{15} = \left\{{1,2,3,4}\right\} \\
%        \mathcal{M}_{16} = \left\{{5}\right\}          & \mathcal{Z}_{16} = \left\{{1,3,5}\right\} \\
%        \mathcal{M}_{28} = \left\{{3,4,5}\right\}      & \mathcal{Z}_{28} = \left\{{2,3,4,5}\right\} \\
%        \mathcal{M}_{29} = \left\{{1,3,4,5}\right\}    & \mathcal{Z}_{29} = \left\{{1,2,3,4,5}\right\}
%    \end{array}
%\]
%\end{center}
%\end{frame}



%\begin{frame}{Søker etter $\mathcal{M}_{14} = \left\{  2,3,4 \right\}$}
%\begin{center}
%\input{include/maptreesets4}
%\[
%\small
%    \begin{array}{ll}
%        \mathcal{M}_0    = \left\{{}\right\}           & \mathcal{Z}_0    = \left\{{1,3}\right\} \\
%        \mathcal{M}_2    = \left\{{2}\right\}          & \mathcal{Z}_2    = \left\{{2,3,5}\right\} \\
%        \mathcal{M}_3    = \left\{{1,2}\right\}        & \mathcal{Z}_3    = \left\{{1,2,4,5}\right\} \\
%        \mathcal{M}_7    = \left\{{1,2,3}\right\}      & \mathcal{Z}_7    = \left\{{1,2,3,5}\right\} \\
%        \mathcal{M}_8    = \left\{{4}\right\}          & \mathcal{Z}_8    = \left\{{1,4,5}\right\} \\
%        \mathcal{M}_{10} = \left\{{2,4}\right\}        & \mathcal{Z}_{10} = \left\{{2,3,4,5}\right\}
%    \end{array}
%~
%    \begin{array}{ll}
%        \mathcal{M}_{12} = \left\{{3,4}\right\}        & \mathcal{Z}_{12} = \left\{{4,3,1}\right\} \\
%        \mathcal{M}_{15} = \left\{{1,2,3,4}\right\}    & \mathcal{Z}_{15} = \left\{{1,2,3,4}\right\} \\
%        \mathcal{M}_{16} = \left\{{5}\right\}          & \mathcal{Z}_{16} = \left\{{1,3,5}\right\} \\
%        \mathcal{M}_{28} = \left\{{3,4,5}\right\}      & \mathcal{Z}_{28} = \left\{{2,3,4,5}\right\} \\
%        \mathcal{M}_{29} = \left\{{1,3,4,5}\right\}    & \mathcal{Z}_{29} = \left\{{1,2,3,4,5}\right\}
%    \end{array}
%\]
%\end{center}
%\end{frame}



%\begin{frame}{Søker etter $\mathcal{M}_{14} = \left\{  2,3,4 \right\}$}
%\begin{center}
%\input{include/maptreesets5}
%\[
%\small
%    \begin{array}{ll}
%        \mathcal{M}_0    = \left\{{}\right\}           & \mathcal{Z}_0    = \left\{{1,3}\right\} \\
%        \mathcal{M}_2    = \left\{{2}\right\}          & \mathcal{Z}_2    = \left\{{2,3,5}\right\} \\
%        \mathcal{M}_3    = \left\{{1,2}\right\}        & \mathcal{Z}_3    = \left\{{1,2,4,5}\right\} \\
%        \mathcal{M}_7    = \left\{{1,2,3}\right\}      & \mathcal{Z}_7    = \left\{{1,2,3,5}\right\} \\
%        \mathcal{M}_8    = \left\{{4}\right\}          & \mathcal{Z}_8    = \left\{{1,4,5}\right\} \\
%        \mathcal{M}_{10} = \left\{{2,4}\right\}        & \mathcal{Z}_{10} = \left\{{2,3,4,5}\right\}
%    \end{array}
%~
%    \begin{array}{ll}
%        \mathcal{M}_{12} = \left\{{3,4}\right\}        & \mathcal{Z}_{12} = \left\{{4,3,1}\right\} \\
%        \mathcal{M}_{15} = \left\{{1,2,3,4}\right\}    & \mathcal{Z}_{15} = \left\{{1,2,3,4}\right\} \\
%        \mathcal{M}_{16} = \left\{{5}\right\}          & \mathcal{Z}_{16} = \left\{{1,3,5}\right\} \\
%        \mathcal{M}_{28} = \left\{{3,4,5}\right\}      & \mathcal{Z}_{28} = \left\{{2,3,4,5}\right\} \\
%        \mathcal{M}_{29} = \left\{{1,3,4,5}\right\}    & \mathcal{Z}_{29} = \left\{{1,2,3,4,5}\right\}
%    \end{array}
%\]
%\end{center}
%\end{frame}



%\begin{frame}{Algoritme: \texttt{find}}
%\begin{algorithm}[H]
%\caption{\texttt{find($\mathcal{M}_l$, $v_k$)}}
%\label{alg:find}
%\input{include/find_algo}
%\end{algorithm}
%\end{frame}


\begin{frame}{Eksperiment 1}
%\begin{itemize}
%\item Vi løser \textit{small}, med $\sigma(2, 238) = 28 442$ subinstanser
%\end{itemize}
Vi løser \textit{small} og opp til $2$ utfall. $28 442$ subinstanser
\begin{table}[ht!]
\centering
\caption{Kjøretid i CPU-sekunder}
\begin{tabular}{rrrrr}
$\epsilon$ & \texttt{cClp} & \texttt{cSlp} & \texttt{nClp} & \texttt{nSlp} \\ \hline
$10^{-1}$ & 45.51 & 55.61 & 72.32 & 85.51 \\
$10^{-2}$ & 46.34 & 55.89 & 73.11 & 85.51 \\
$10^{-3}$ & 51.12 & 59.04 & 75.60 & 85.28 \\
$10^{-4}$ & 52.46 & 73.79 & 77.83 & 107.39 \\
$10^{-5}$ & 54.48 & 232.53 & 81.16 & 355.47 \\
$10^{-6}$ & 65.42 & 1363.46 & 93.29 & 2022.25 \\
$10^{-7}$ & 70.78 & 6522.91 & 100.85 & 9395.92
\end{tabular}
\label{table:expone}
\end{table}
\end{frame}



\begin{frame}{Eksperiment 1}
\begin{figure}[ht!]
    \centering
    \input{include/small_tolerance}
    \caption{Kjøretid i CPU-sekunder for å løse \textit{small} og dens subinstanser.}
    \label{fig:smalltolerance}
\end{figure}
\end{frame}



\begin{frame}{Eksperiment 2}
\begin{table}
\centering
\caption{Kjøretid i CPU-sekunder for å løse de tre instansene.}
\label{table:eps4instances}
\begin{tabular}{crrr}
\textrm{Implementasjon} & \textit{small} & \textit{large} & \textit{vlarge} \\ \hline
\texttt{cClp}           & 0.52           & 9.55           & 76.18 \\
\texttt{cSlp}           & 0.71           & 32.88          & 585.60 \\
\texttt{nClp}           & 0.65           & 11.68          & 157.53 \\
\texttt{nSlp}           & 0.89           & 39.87          & 1173.74
\end{tabular}
\end{table}
\end{frame}



\begin{frame}{Tilfeldige instanser}
\begin{itemize}
\item $m = \lfloor \frac{7}{20}n \rfloor$
\item 50\% null i $b$ og $H$
\end{itemize}
\end{frame}



\begin{frame}{Eksperiment 3}
\begin{table}[ht!]
    \centering
    \caption{Kjøretid for å løse tilfeldige instanser med økende $n$. $\beta = 1$.}
    \label{table:expfour}
\begin{tabular}{rrrc}
    $n$ & \texttt{cClp}  & \texttt{nClp}  & Relativ Speedup \\ \hline
    500 & 4.9   & 5.9   & 16.9\% \\
   1000 & 42.1  & 53.0  & 20.6\% \\
   1500 & 181.5 & 234.5 & 22.6\% \\
   2000 & 547.1 & 710.2 & 23.0\%
\end{tabular}
\end{table}
\end{frame}



\begin{frame}{Eksperiment 4}
\begin{table}[ht!]
\centering
\caption{Kjøretid i CPU-sekunder for $n = 50$ og økende $\beta$.}
\begin{tabular}{rrrcr}
      $\beta$ & \texttt{cClp} & \texttt{nClp} & Relativ Speedup & Distinkte løsninger\\ \hline
       1  & 0.03 & 0.04 & 25.0\% & 37.4 ($74.3$\%) \\
       2  & 0.64 & 0.94 & 31.9\% & 744.3 ($58.3$\%) \\
       3  & 7.06 & 15.90 & 55.6\% & 9484.7 ($45.4$\%) \\
       4  & 77.59 & 188.83 & 58.9\% & 82262.5 ($32.8$\%) \\
       5  & 586.54 & 1758.23 & 66.6\% & 574685.0 ($24.2$\%) \\
\end{tabular}
\label{table:exptwo}
\end{table}
\end{frame}



\begin{frame}{Eksperiment 4}
\input{include/construct_incb}
\end{frame}



\begin{frame}{Vi konkluderer}
\begin{itemize}
\item Raskere jo flere subinstanser vi løser
\item Speedup uavhengig av løser.
\end{itemize}
\end{frame}



\end{document}
